<template>
    <div class="form-row row d-flex align-items-center">
        <div class="form-group col-md-3">
            <label>Project</label>
            <select class="form-control" v-model="projectId" v-on:change="updateActiveProject">
                <option v-for="project in client.projects" :value="project.id">{{ project.name }}</option>
            </select>
        </div>
        <div class="form-group col-md-3">
            <label>Stage</label>
            <select class="form-control" v-model="stageId" v-on:change="updateActiveStage">
                <option v-for="stage in activeProject.stages" :value="stage.id">{{ stage.name }}</option>
            </select>
        </div>
        <div class="form-group col-md-2">
            <label>Billing</label>
            <select name="billings[]" class="form-control" v-model="billingId">
                <option v-for="stageBilling in activeStage.billings" :value="stageBilling.id">{{ stageBilling.percentage + '%' }} â€“  {{ client.currency }} {{ stageBilling.amount }}</option>
            </select>
        </div>
        <div class="col-md-1">
            <span class="c-pointer text-danger" v-on:click="$emit('remove')"><u>Remove</u></span>
        </div>
    </div>
</template>


<script>
    export default {
        props: ['client', 'billing'],
        watch: {
            client(newClient, oldClient) {
                this.projectId = newClient.projects[0].id;
                this.stageId = newClient.projects[0].stages[0].id;
                this.updateActiveProject();
                this.updateActiveStage();
            }
        },
        data() {
            return {
                projectId: this.client.projects[0].id,
                stageId: this.client.projects[0].stages[0].id,
                billingId: this.billing ? this.billing.id : null,
                activeProject: this.client.projects[0],
                activeStage: this.client.projects[0].stages[0],
            }
        },
        methods: {
            updateActiveProject() {
                for (let index in this.client.projects) {
                    let project = this.client.projects[index];
                    if (project.id == this.projectId) {
                        this.activeProject = project;
                        this.stageId = this.activeProject.stages[0].id;
                        break;
                    }
                }
                this.updateActiveStage();
            },
            updateActiveStage() {
                for (let index in this.activeProject.stages) {
                    let stage = this.activeProject.stages[index];
                    if (stage.id == this.stageId) {
                        this.activeStage = stage;
                        this.billingId = this.activeStage.billings[0].id;
                        break;
                    }
                }
            },
        },
        mounted() {
            this.updateActiveProject();
            this.updateActiveStage();
        }
    }
</script>
